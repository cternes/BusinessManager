<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd	
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">

    <!-- Spring-Security JDBC Service. This must NOT be changed. -->
	<bean id="jdbcUserService" class="ch.vqf.cp.database.SpringSecurityDaoImpl">
		<property name="dataSource" ref="dataSource"/>
		<property name="enableGroups" value="true" />
		<property name="enableAuthorities" value="false" />
		<property name="groupAuthoritiesByUsernameQuery">
			<value>SELECT R.ID, R.NAME, P.NAME
			FROM ROLES R 
			JOIN ROLE_MEMBERS RM on R.id = RM.roles_id
			JOIN USERS U on U.id = RM.members_id
			JOIN ROLE_PERMISSIONS RP ON RP.roles_id = R.id
			JOIN PERMISSIONS P ON P.id = RP.permissions_id
			WHERE U.username=?
			</value>
		</property>
	</bean>
	
	 <!-- Spring-Security Success Handler. This is needed for password change after first login. This must NOT be changed. -->
	<bean id="customSuccessHandler" class="ch.vqf.cp.web.controller.CustomAuthenticationSuccessHandler">
	</bean>
	
	<!-- Spring-Security Salt. This must NOT be changed. -->
	<bean class="org.springframework.security.authentication.dao.ReflectionSaltSource" id="saltSource">
		<property name="userPropertyToUse" value="username"/>
	</bean>
		
</beans>
