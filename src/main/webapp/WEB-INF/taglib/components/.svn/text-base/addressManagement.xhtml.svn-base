<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<!-- NOTE: 	-Always nest this component as a child into another form!
				-In the parent form always use prependId="false"
				-Pass the parent form id as parameter into this component with id=":<parentFormId>" 
	-->

	<p:panel header="#{messages.addressmanagement_title}" toggleable="true" toggleSpeed="500" collapsed="false" id="addressManagementForm">
		<p:messages globalOnly="true" />
		
		<p:commandButton value="#{messages.addressmanagement_add_address}" update="addressManagementForm" process="@this, addressManagementForm" rendered="#{not addressManagementController.isMaximumReached}" icon="ui-icon-plusthick">
			<f:setPropertyActionListener target="#{addressManagementController.showAddressAddDialog}" value="#{true}" />
		</p:commandButton>

		<p/>
		
		<p:dataTable id="datatable" value="#{addressManagementController.addressList}"
			var="address" rowKey="#{address.id}"
			selection="#{addressManagementController.selectedAddress}"
			selectionMode="single" emptyMessage="#{messages.empty_table_message}">
			<p:column headerText="#{messages.addressmanagement_address_type}">
				<h:outputText value="#{address.type.label}"></h:outputText>
			</p:column>
			<p:column headerText="#{messages.addressmanagement_address_street}">
				<h:outputText value="#{address.street}"></h:outputText>
			</p:column>
			<p:column headerText="#{messages.addressmanagement_address_housenumber}">
				<h:outputText value="#{address.houseNumber}"></h:outputText>
			</p:column>
			<p:column headerText="#{messages.addressmanagement_address_zipcode}">
				<h:outputText value="#{address.zipCode}"></h:outputText>
			</p:column>
			<p:column headerText="#{messages.addressmanagement_address_city}">
				<h:outputText value="#{address.city}"></h:outputText>
			</p:column>

			<f:facet name="footer">
				<div class="stickAtRightBorder">
					<p:commandButton value="#{messages.addressmanagement_update_address}" icon="ui-icon-pencil"	action="#{addressManagementController.viewSelected}" update="#{id}:addressManagementForm">
						<f:setPropertyActionListener target="#{addressManagementController.showAddressUpdateDialog}" value="#{true}" />
					</p:commandButton>
					<p:commandButton value="#{messages.addressmanagement_delete_address}" action="#{addressManagementController.deleteSelected}" update="#{id}:addressManagementForm" icon="ui-icon-closethick" styleClass="marginButton" />
				</div>
			</f:facet>
		</p:dataTable>

		<p:spacer height="20" />

		<p:panel header="#{addressManagementController.panelTitle}" id="addAddress" rendered="#{addressManagementController.showAddressAddDialog or addressManagementController.showAddressUpdateDialog}">
			<p:panelGrid>
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_type}:"/>
					</p:column>

					<p:column colspan="2">
						<p:selectOneMenu id="addType" value="#{addressManagementController.addressToUpdate.type}" style="width: 210px;">
							<f:selectItems value="#{addressManagementController.availableAddressTypeValues}" var="type" itemValue="#{type}" itemLabel="#{type.label}"/>
						</p:selectOneMenu>
					</p:column>
					<p:column>
						<p:message for="addType" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_supplement}:" />
					</p:column>
					<p:column colspan="2">
						<p:inputText id="addSupplement"	value="#{addressManagementController.addressToUpdate.addressSupplement}" styleClass="fullSizeInput"/>	
					</p:column>
					<p:column>
						<p:message for="addSupplement" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_forAttentionOf}:" />
					</p:column>
					<p:column colspan="2">
						<p:inputText id="addAttentionOf" value="#{addressManagementController.addressToUpdate.forAttentionOf}" styleClass="fullSizeInput"/>	
					</p:column>
					<p:column>
						<p:message for="addAttentionOf" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_street}/#{messages.addressmanagement_address_housenumber}:" />
					</p:column>
					<p:column colspan="2">
						<p:inputText id="addStreet"	value="#{addressManagementController.addressToUpdate.street}" styleClass="fullSizeInput" />	
					</p:column>
					<p:column>
						<p:message for="addStreet" display="icon"/>
					</p:column>
					
					<p:column>
						<p:inputText id="addNumber"	value="#{addressManagementController.addressToUpdate.houseNumber}" maxlength="5" styleClass="smallInput"/>
					</p:column>
					
					
					<p:column>
						<p:selectOneMenu id="addAddressDisplayType" value="#{addressManagementController.addressToUpdate.addressDisplayType}">
							<f:selectItems value="#{addressManagementController.addressToUpdate.availableAddressDisplayTypes}" var="type" itemValue="#{type}" itemLabel="#{type.label}"/>
						</p:selectOneMenu>
					</p:column>
					<p:column>
						<p:message for="addNumber" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel for="addPob" value="#{messages.addressmanagement_address_post_office_box}:"></h:outputLabel>
					</p:column>
					<p:column colspan="2">
						<p:inputText id="addPob" value="#{addressManagementController.addressToUpdate.postOfficeBox}" styleClass="fullSizeInput" />	
					</p:column>
					<p:column>
						<p:message for="addPob" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_zipcode}/#{messages.addressmanagement_address_city}:"></h:outputLabel>
					</p:column>
					<p:column>
						<p:inputText id="addZip" value="#{addressManagementController.addressToUpdate.zipCode}" styleClass="mediumInput">
							<p:ajax event="blur" listener="#{addressManagementController.findCityByZip}" update="addCity"/>
						</p:inputText>
					</p:column>
					<p:column>
						<p:autoComplete id="addCity" minQueryLength="3" value="#{addressManagementController.addressToUpdate.city}" effect="fade" completeMethod="#{addressManagementController.cityAutoComplete}" styleClass="fullSizeInput">
							<p:ajax event="itemSelect" listener="#{addressManagementController.handleSelectedCity}" update="addZip, addCity" />
						</p:autoComplete>
					</p:column>
					<p:column>
						<p:message for="addZip" display="icon"/>
						<p:message for="addCity" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_country}:"></h:outputLabel>
					</p:column>
					<p:column colspan="2">
 						<p:selectOneMenu id="addCountry" value="#{addressManagementController.addressToUpdate.countryRef}" effect="fade" converter="#{countryConverter}">  
            				<f:selectItems value="#{addressManagementController.countryList}" var="cref" itemLabel="#{cref.country}" itemValue="#{cref}"/>  
        				</p:selectOneMenu>  
					</p:column>
					<p:column>
						<p:message for="addCountry" display="icon"/>
					</p:column>
				</p:row>
				
				<p:row>
					<p:column>
						<h:outputLabel value="#{messages.addressmanagement_address_phone}/#{messages.addressmanagement_address_fax}:"></h:outputLabel>
					</p:column>
					<p:column colspan="2">
						<p:inputText id="addPhone" value="#{addressManagementController.addressToUpdate.phone}" styleClass="fullSizeInput"/>	
					</p:column>
					<p:column>
						<p:message for="addPhone" display="icon"/>
					</p:column>
					<p:column colspan="2">
						<p:inputText id="addFax" value="#{addressManagementController.addressToUpdate.fax}" styleClass="veryLargeInput"/>
					</p:column>
				</p:row>
			</p:panelGrid>
			
			<p:spacer height="20"/>
			
			<div class="stickAtRightBorder">
				<p:commandButton value="#{messages.ok}" action="#{addressManagementController.addAddress}" process="@this, addAddress" update="addressManagementForm" rendered="#{addressManagementController.showAddressAddDialog}" styleClass="marginButton, defaultButtonSize"/>
				<p:commandButton value="#{messages.ok}" action="#{addressManagementController.updateAddress}"	update="addressManagementForm" rendered="#{addressManagementController.showAddressUpdateDialog}" styleClass="marginButton, defaultButtonSize" />
				<p:commandButton value="#{messages.cancel}" actionListener="#{addressManagementController.closePanel}" immediate="true" update="addressManagementForm" styleClass="marginButton"/>
			</div>
		</p:panel>
	</p:panel>
</ui:composition>